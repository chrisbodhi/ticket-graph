"use strict";var assigneeIds=[],dataArray=[],ticketsToChart=[],callSW=function(){var a=new RSVP.Promise(function(a,b){var c=new SW.Card,d=c.services("helpdesk");d.request("tickets").then(function(c){c.tickets.length>0?a(c.tickets):b("err")})});return a};callSW().then(function(a){ticketsToChart=a.filter(function(a){return"open"===a.status&&a.assignee?a:void 0}),assigneeIds=ticketsToChart.map(function(a){return a.assignee.id});var b=function(a){for(var b={},c=[],d=a.length,e=0,f=0;d>f;f++){var g=a[f];1!==b[g]&&(b[g]=1,c[e++]=g)}return c};assigneeIds=b(assigneeIds);var c=function(a){var b=(Date.now()-new Date(a))/864e5;return Math.floor(b)},d=function(a){var b={};return b.ticketId=a.id,b.priority=a.priority,b.daysOpen=c(a.created_at),b.reopened=a.reopened,b},e=function(a){return ticketsToChart.filter(function(b){return a===b.assignee.id?b:void 0})};assigneeIds.forEach(function(a){var b={assigneeId:a,assigneeName:"",tickets:[]},c=e(a);c.forEach(function(a){b.tickets.push(d(a))}),dataArray.push(b),b={}});var f=[];f.push({priority:"Low",data:[]},{priority:"Medium",data:[]},{priority:"High",data:[]});var g=function(a,b){return a.tickets.filter(function(a){return a.priority===b?1:void 0}).length},h=function(a,b,c,d){f.forEach(function(e){"Low"===e.priority?e.data.push({assId:a.assigneeId,count:b}):"Medium"===e.priority?e.data.push({assId:a.assigneeId,count:c}):"High"===e.priority?e.data.push({assId:a.assigneeId,count:d}):console.error("No priority noted for ticket "+a)})};dataArray.forEach(function(a){var b=g(a,1),c=g(a,2),d=g(a,3);h(a,b,c,d)}),console.log(f);var i=f.map(function(a){return a.data.map(function(a){return{y:a.count,x:a.assId}})}),j=(f.map(function(a){return a.priority}),600),k=500,l=d3.layout.stack();l(i),i=i.map(function(a){return a.map(function(a){return{x:a.y,y:a.x,x0:a.y0}})});var m=d3.max(i,function(a){return d3.max(a,function(a){return a.x+a.x0})}),n=d3.scale.linear().domain([0,m]).range([0,j]),o=[29,3,2],p=d3.scale.ordinal().domain(o).rangeRoundBands([0,k],.1),q=d3.scale.category10(),r=d3.select(".jumbotron").append("svg").attr("width",j+60).attr("height",k).append("g").attr("transform","translate(20, 0)"),s=r.selectAll("g").data(i).enter().append("g").style("fill",function(a,b){return q(b)}),t=(s.selectAll("rect").data(function(a){return a}).enter().append("rect").attr("x",function(a){return n(a.x0)}).attr("y",function(a){return p(a.y)}).attr("height",function(){return p.rangeBand()}).attr("width",function(a){return n(a.x)}).on("mouseover",function(a){var b=parseFloat(d3.select(this).attr("x"))+j,c=parseFloat(d3.select(this).attr("y"))+p.rangeBand();console.log(b),console.log(c),d3.select("#d3-tooltip").style("left",b-j/2+"px").style("top",c+"px").select("#value").text(a.x),d3.select("#d3-tooltip").classed("hidden",!1)}).on("mouseout",function(){d3.select("#d3-tooltip").classed("hidden",!0)}),d3.svg.axis().scale(n).ticks(i[0].length).orient("bottom")),u=d3.svg.axis().scale(p).orient("left");r.append("g").attr("class","axis").attr("transform","translate(0,"+(k-17)+")").call(t),r.append("g").attr("class","axis").call(u)});var assigneeIds=[],dataArray=[],ticketsToChart=[],callSW=function(){var a=new RSVP.Promise(function(a,b){var c=new SW.Card,d=c.services("helpdesk");d.request("tickets").then(function(c){c.tickets.length>0?a(c.tickets):b("err")})});return a};callSW().then(function(a){ticketsToChart=a.filter(function(a){return"open"===a.status&&a.assignee?a:void 0}),assigneeIds=ticketsToChart.map(function(a){return a.assignee.id});var b=function(a){for(var b={},c=[],d=a.length,e=0,f=0;d>f;f++){var g=a[f];1!==b[g]&&(b[g]=1,c[e++]=g)}return c};assigneeIds=b(assigneeIds);var c=function(a){var b=(Date.now()-new Date(a))/864e5;return Math.floor(b)},d=function(a){var b={};return b.ticketId=a.id,b.priority=a.priority,b.daysOpen=c(a.created_at),b.reopened=a.reopened,b},e=function(a){return ticketsToChart.filter(function(b){return a===b.assignee.id?b:void 0})};assigneeIds.forEach(function(a){var b={assigneeId:a,assigneeName:"",tickets:[]},c=e(a);c.forEach(function(a){b.tickets.push(d(a))}),dataArray.push(b),b={}});var f=[];f.push({priority:"Low",data:[]},{priority:"Medium",data:[]},{priority:"High",data:[]});var g=function(a,b){return a.tickets.filter(function(a){return a.priority===b?1:void 0}).length},h=function(a,b,c,d){f.forEach(function(e){"Low"===e.priority?e.data.push({assId:a.assigneeId,count:b}):"Medium"===e.priority?e.data.push({assId:a.assigneeId,count:c}):"High"===e.priority?e.data.push({assId:a.assigneeId,count:d}):console.error("No priority noted for ticket "+a)})};dataArray.forEach(function(a){var b=g(a,1),c=g(a,2),d=g(a,3);h(a,b,c,d)})});var ticketCounts=[{priority:"Low",data:[{assId:"Alice",count:1},{assId:"Bob",count:0},{assId:"Carol",count:1}]},{priority:"Medium",data:[{assId:"Alice",count:3},{assId:"Bob",count:3},{assId:"Carol",count:3}]},{priority:"High",data:[{assId:"Alice",count:1},{assId:"Bob",count:2},{assId:"Carol",count:0}]}],stackData=ticketCounts.map(function(a){return a.data.map(function(a){return{y:a.count,x:a.assId}})}),width=600,height=500,priorityLevels=ticketCounts.map(function(a){return a.priority}),stack=d3.layout.stack();stack(stackData),stackData=stackData.map(function(a){return a.map(function(a){return{x:a.y,y:a.x,x0:a.y0}})});var xMax=d3.max(stackData,function(a){return d3.max(a,function(a){return a.x+a.x0})}),xScale=d3.scale.linear().domain([0,xMax]).range([0,width]),names=["Alice","Bob","Carol"],yScale=d3.scale.ordinal().domain(names).rangeRoundBands([0,height],.1),colors=d3.scale.category10(),canvas=d3.select(".jumbotron").append("svg").attr("width",width+60).attr("height",height).append("g").attr("transform","translate(20, 0)"),groups=canvas.selectAll("g").data(stackData).enter().append("g").style("fill",function(a,b){return colors(b)}),rects=groups.selectAll("rect").data(function(a){return a}).enter().append("rect").attr("x",function(a){return xScale(a.x0)}).attr("y",function(a){return yScale(a.y)}).attr("height",function(){return yScale.rangeBand()}).attr("width",function(a){return xScale(a.x)}).on("mouseover",function(a){var b=parseFloat(d3.select(this).attr("x"))+width,c=parseFloat(d3.select(this).attr("y"))+yScale.rangeBand();d3.select("#d3-tooltip").style("left",b+"px").style("top",c+"px").select("#value").text(a.x),d3.select("#d3-tooltip").classed("hidden",!1)}).on("mouseout",function(){d3.select("#d3-tooltip").classed("hidden",!0)}),xAxis=d3.svg.axis().scale(xScale).ticks(stackData[0].length).orient("bottom"),yAxis=d3.svg.axis().scale(yScale).orient("left");canvas.append("g").attr("class","axis").attr("transform","translate(30,"+(height-20)+")").call(xAxis),canvas.append("g").attr("class","axis").attr("transform","translate(30, 0)").call(yAxis);